<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player de Áudio e Vídeo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #181818;
      color: #EEEEEE;
      text-align: center;
      padding: 20px;
      margin: 0;
    }
    .player-container {
      position: relative;
      background: #222222;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
      max-width: 100%;
      width: 600px;
      margin: auto;
    }
    #menuBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 18px;
      color: #EEEEEE;
      cursor: pointer;
    }
    .menu-dropdown {
      display: none;
      position: absolute;
      top: 35px;
      right: 10px;
      background: #333333;
      border: 1px solid #444444;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.7);
      z-index: 10;
    }
    .menu-dropdown button {
      display: block;
      background: none;
      border: none;
      padding: 8px 12px;
      width: 100%;
      text-align: left;
      cursor: pointer;
      color: #EEEEEE;
    }
    .menu-dropdown button:hover { background: #444444; }
    .button {
      padding: 10px 20px;
      background-color: #FF4500;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .button:hover { opacity: 0.9; }
    video, iframe {
      background: black;
      width: 100%;
      height: auto;
      display: none;
      border-radius: 4px;
    }
    iframe { height: 300px; }
    .dialog-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .dialog {
      background: #222222;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 360px;
      text-align: left;
      color: #EEEEEE;
      position: relative;
    }
    .input-row {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .dialog input[type=text] {
      flex: 1;
      padding: 5px;
      border: 1px solid #444;
      border-radius: 4px;
      background: #333;
      color: #EEE;
    }
    .ellipsis-btn {
      background: none;
      border: none;
      font-size: 20px;
      color: #EEEEEE;
      cursor: pointer;
    }
    .dialog .history {
      margin-top: 10px;
      max-height: 100px;
      overflow-y: auto;
      font-size: 14px;
      background: #111;
      padding: 5px;
      border-radius: 4px;
      display: none;
    }
    .dialog .history div {
      margin: 2px 0;
      cursor: pointer;
      color: #4EA8DE;
    }
    .audio-device-select {
      margin-top: 10px;
      width: 100%;
      padding: 5px;
      border-radius: 4px;
      background: #333;
      color: #EEE;
      border: 1px solid #444;
    }
    .dialog .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 18px;
      color: #EEEEEE;
      cursor: pointer;
    }
    @media (max-width: 600px) {
      .player-container { padding: 15px; width: 95%; }
      .dialog { width: 95%; padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="player-container">
    <button id="menuBtn">⋮</button>
    <div class="menu-dropdown" id="menuDropdown">
      <button id="reloadBtn">Recarregar Página</button>
      <button id="clearHistoryBtn">Limpar Histórico</button>
    </div>
    <video id="mediaPlayer" controls></video>
    <iframe id="youtubePlayer" allow="autoplay" allowfullscreen></iframe>
    <div style="margin-top:10px;">
      <button class="button" id="openDialogBtn">Modo Vídeo/Áudio</button>
    </div>
  </div>

  <div class="dialog-overlay" id="dialogOverlay">
    <div class="dialog">
      <button class="close-btn" onclick="document.getElementById('dialogOverlay').style.display='none'">✕</button>
      <h3>Selecionar Arquivo ou Link</h3>
      <button class="button" id="chooseFileBtn" style="margin-bottom:10px;">Escolher Vídeo/Áudio</button><br>
      <div class="input-row">
        <input type="text" id="linkInput" placeholder="Cole um link e pressione Enter">
        <button class="ellipsis-btn" id="historyToggleBtn">⋯</button>
      </div>
      <button class="button" id="sendLinkBtn" style="margin-top:5px;">Enviar</button>
      <div class="history" id="historyList"></div>
    </div>
  </div>

  <div class="dialog-overlay" id="deviceOverlay">
    <div class="dialog">
      <h3>Selecione Saída de Áudio</h3>
      <select id="audioDeviceSelect" class="audio-device-select"></select><br><br>
      <button class="button" id="deviceOkBtn">OK</button>
    </div>
  </div>

  <script>
    const menuBtn = document.getElementById('menuBtn');
    const menuDropdown = document.getElementById('menuDropdown');
    const reloadBtn = document.getElementById('reloadBtn');
    const clearHistoryBtn = document.getElementById('clearHistoryBtn');
    const overlay = document.getElementById('dialogOverlay');
    const openBtn = document.getElementById('openDialogBtn');
    const chooseFileBtn = document.getElementById('chooseFileBtn');
    const linkInput = document.getElementById('linkInput');
    const sendLinkBtn = document.getElementById('sendLinkBtn');
    const historyList = document.getElementById('historyList');
    const historyToggleBtn = document.getElementById('historyToggleBtn');
    const player = document.getElementById('mediaPlayer');
    const youtubePlayer = document.getElementById('youtubePlayer');
    const deviceOverlay = document.getElementById('deviceOverlay');
    const audioDeviceSelect = document.getElementById('audioDeviceSelect');
    const deviceOkBtn = document.getElementById('deviceOkBtn');
    let history = JSON.parse(localStorage.getItem('mediaHistory') || '[]');

    function refreshHistory() {
      historyList.innerHTML = '';
      history.forEach(item => {
        const div = document.createElement('div');
        div.textContent = item;
        div.onclick = () => preparePlay(item);
        historyList.appendChild(div);
      });
    }

    historyToggleBtn.onclick = () => {
      historyList.style.display = historyList.style.display === 'block' ? 'none' : 'block';
    };

    async function selectAudioDevice() {
      if (typeof player.setSinkId !== 'function') return true;
      const devices = await navigator.mediaDevices.enumerateDevices();
      const outputs = devices.filter(d => d.kind === 'audiooutput');
      if (outputs.length <= 1) return true;
      audioDeviceSelect.innerHTML = '';
      outputs.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d.deviceId;
        opt.text = d.label || 'Dispositivo';
        audioDeviceSelect.appendChild(opt);
      });
      deviceOverlay.style.display = 'flex';
      return new Promise(resolve => {
        deviceOkBtn.onclick = () => {
          player.setSinkId(audioDeviceSelect.value).catch(console.error);
          deviceOverlay.style.display = 'none';
          resolve(true);
        };
      });
    }

    function isYouTubeLink(url) {
      return /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)[\w-]+/.test(url);
    }

    function getYouTubeEmbedURL(url) {
      const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+)/);
      return match ? `https://www.youtube.com/embed/${match[1]}?autoplay=1` : url;
    }

    async function preparePlay(src) {
      overlay.style.display = 'none';
      historyList.style.display = 'none';
      if (await selectAudioDevice()) playMedia(src);
    }

    function playMedia(src) {
      if (isYouTubeLink(src)) {
        player.style.display = 'none';
        player.pause();
        youtubePlayer.src = getYouTubeEmbedURL(src);
        youtubePlayer.style.display = 'block';
      } else {
        youtubePlayer.style.display = 'none';
        youtubePlayer.src = '';
        player.src = src;
        player.style.display = 'block';
        player.play().catch(console.error);
      }
      if (!history.includes(src)) {
        history.unshift(src);
        if (history.length > 10) history.pop();
        localStorage.setItem('mediaHistory', JSON.stringify(history));
        refreshHistory();
      }
    }

    openBtn.onclick = () => overlay.style.display = 'flex';
    chooseFileBtn.onclick = () => {
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'audio/*,video/*';
      fileInput.onchange = e => {
        const file = e.target.files[0];
        if (file) preparePlay(URL.createObjectURL(file));
      };
      fileInput.click();
    };
    sendLinkBtn.onclick = () => {
      const url = linkInput.value.trim();
      if (url) preparePlay(url);
    };
    linkInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendLinkBtn.click();
    });
    menuBtn.onclick = () => {
      menuDropdown.style.display = menuDropdown.style.display === 'block' ? 'none' : 'block';
    };
    reloadBtn.onclick = () => location.reload();
    clearHistoryBtn.onclick = () => {
      history = [];
      localStorage.removeItem('mediaHistory');
      refreshHistory();
      menuDropdown.style.display = 'none';
    };
    document.addEventListener('click', e => {
      if (!menuBtn.contains(e.target) && !menuDropdown.contains(e.target)) menuDropdown.style.display = 'none';
    });

    refreshHistory();
  </script>
</body>
</html>
