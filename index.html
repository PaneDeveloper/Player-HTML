<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Player de Áudio e Vídeo</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body { height:100%; background:#121212; color:white; font-family: Arial,sans-serif; }
    .container { display:flex; height:100%; }
    @media(min-width:1200px) {
      .container{flex-direction:row;}
      #playerArea{width:70%;}
      #playlistArea{width:15%;}
      #chatArea{width:15%;}
    }
    @media(min-width:768px) and (max-width:1199px) {
      .container{flex-direction:row;}
      #playerArea,#playlistArea,#chatArea{flex:1;}
    }
    @media(max-width:767px) {
      .container{flex-direction:column;}
      #playlistArea{position:fixed;bottom:0;left:0;width:100%;height:180px;border-top:1px solid #333;transform:translateY(100%);transition:transform .3s;}
      #playlistArea.active{transform:translateY(0);}
      #chatArea{display:none;}
    }
    #playerArea{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem;}
    video,audio,iframe{width:100%;max-width:800px;max-height:450px;background:black;border-radius:6px;}
    #controls{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;}
    button{background:#ff4500;border:none;padding:.5rem 1rem;border-radius:5px;color:white;cursor:pointer;}
    #inputArea{margin-top:1rem;display:flex;gap:.5rem;width:100%;max-width:800px;}
    #linkInput{flex:1;padding:.5rem;border-radius:4px;border:none;}
    #playlistArea,#chatArea{background:#1f1f1f;overflow-y:auto;border-left:1px solid #333;}
    #playlistList{padding:1rem;}
    .playlist-item{display:flex;align-items:center;gap:.5rem;background:#2a2a2a;margin-bottom:.5rem;border-radius:4px;padding:.5rem;position:relative;cursor:pointer;}
    .playlist-item.active{background:#ff4500;}
    .thumb{width:60px;height:45px;border-radius:4px;object-fit:cover;}
    .info{flex:1;overflow:hidden;}
    .remove-btn{position:absolute;top:5px;right:5px;background:red;border:none;color:white;border-radius:50%;width:20px;height:20px;font-size:14px;display:none;cursor:pointer;}
    .playlist-item:hover .remove-btn{display:block;}
    #menuBtn{position:fixed;bottom:10px;right:10px;width:40px;height:40px;border-radius:50%;background:#2a2a2a;color:white;font-size:24px;border:none;cursor:pointer;}
    #menuDropdown{display:none;position:fixed;bottom:60px;right:10px;background:#2a2a2a;border-radius:5px;padding:.5rem;}
    #menuDropdown button,#menuDropdown label{display:block;background:none;border:none;color:white;padding:.5rem;text-align:left;cursor:pointer;}
    #menuDropdown button:hover,#menuDropdown label:hover{background:#444;}
    #debugBox{display:none;position:fixed;bottom:0;left:0;background:#333;color:#ccc;padding:.5rem;font-family:monospace;font-size:.8rem;max-width:300px;max-height:200px;overflow-y:auto;border-top-right-radius:6px;}
  </style>
</head>
<body>
  <div class="container">
    <div id="playerArea">
      <video id="mediaPlayer" controls></video>
      <audio id="audioPlayer" controls style="display:none;"></audio>
      <iframe id="youtubePlayer" allowfullscreen style="display:none;"></iframe>
      <div id="controls">
        <button id="stopBtn">■ Parar</button>
        <button id="togglePlaylistBtn">▶ Lista</button>
        <button id="fileSelectBtn">Escolher Vídeo/Áudio</button>
        <input type="file" id="fileInput" accept="audio/*,video/*" multiple style="display:none;" />
      </div>
      <div id="inputArea">
        <input type="text" id="linkInput" placeholder="Cole link e Enter/ Ctrl+Enter" />
        <button id="sendLinkBtn">Enviar</button>
      </div>
    </div>
    <div id="playlistArea">
      <div id="playlistList"></div>
    </div>
    <iframe id="chatArea" src="" style="display:none;border:none;"></iframe>
  </div>
  <div id="debugBox"></div>
  <button id="menuBtn">☰</button>
  <div id="menuDropdown">
    <button id="reloadBtn">Recarregar</button>
    <button id="clearHistoryBtn">Limpar Fila</button>
    <label><input type="checkbox" id="debugToggle" /> Debug</label>
  </div>
  <script>
    const youtubePlayer = document.getElementById('youtubePlayer');
    const chatArea = document.getElementById('chatArea');
    function getYouTubeId(url) {
      try {
        if (url.includes('youtu.be/')) return url.split('youtu.be/')[1].split('?')[0];
        if (url.includes('youtube.com/watch')) return new URL(url).searchParams.get('v');
        if (url.includes('/shorts/')) return url.split('/shorts/')[1].split('?')[0];
      } catch { return null; }
    }
    function isYouTubeLive(videoId) {
      return videoId?.startsWith('live');
    }
    const originalPlayItem = window.playItem;
    window.playItem = function(i) {
      currentIndex = i;
      const item = playlist[i];
      mediaPlayer.style.display = 'none';
      audioPlayer.style.display = 'none';
      youtubePlayer.style.display = 'none';
      chatArea.style.display = 'none';
      mediaPlayer.pause();
      audioPlayer.pause();
      if (item.src?.includes('youtube.com') || item.src?.includes('youtu.be') || item.src?.includes('/shorts/')) {
        const id = getYouTubeId(item.src);
        if (id) {
          youtubePlayer.src = `https://www.youtube.com/embed/${id}?autoplay=1`;
          youtubePlayer.style.display = 'block';
          chatArea.src = `https://www.youtube.com/live_chat?v=${id}&embed_domain=${location.hostname}`;
          chatArea.style.display = 'block';
        }
      } else {
        originalPlayItem(i);
      }
      renderPlaylist();
    }
  </script>
</body>
</html>
